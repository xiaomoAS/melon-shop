{"version":3,"file":"service.js","sources":["utils/service.js"],"sourcesContent":["import Request from '@/utils/luch-request/index.js'\r\n\r\nconst baseURL = 'https://www.melon-bamboo.com';\r\n// if (process.env.NODE_ENV === 'development') {\r\n// \t// 开发环境\r\n// \t// var baseURL = 'http://127.0.0.1:4523/m1/6785558-6497977-default'; //域名(网站启动时的域名)，目前用这个 js（【注意】记住改manifest.josn 源码视图中的h5配置）\r\n// } else {\r\n// \t// 生产环境\r\n// \tvar baseURL = '101.201.111.162'; //域名(网站启动时的域名)，目前用这个 js\r\n// }\r\n\r\nconst http = new Request()\r\n\r\n\r\n// setConfig 这里只会执行一次。\r\nhttp.setConfig((config) => {\r\n\t/* 设置全局配置 */\r\n\tconfig.baseURL = baseURL\r\n\tconfig.header = {\r\n\t\t...config.header,\r\n\t}\r\n\treturn config\r\n})\r\n\r\n// 请求拦截\r\nhttp.interceptors.request.use((config) => { // 可使用async await 做异步操作\r\n\r\n\t//是否显示等待框\r\n\tlet show = config.custom.show ? config.custom.show : false;\r\n\tif (show) {\r\n\t\tlet title_name = show != true ? show : \"\";\r\n\t\tuni.showLoading({\r\n\t\t\ttitle: title_name,\r\n\t\t\tmask:true,//是否显示透明蒙层，防止触摸穿透，默认：false\r\n\t\t});\r\n\t}\r\n\r\n\tconfig.header = {\r\n\t\t...config.header,\r\n\t\t'wechat_token': uni.getStorageSync('token'),\r\n\t}\r\n\treturn config\r\n}, (err) => {\r\n\treturn Promise.reject(err)\r\n})\r\n\r\n// 防止重复刷新标志位\r\nlet isRefreshing = false\r\n// 重试队列，每一项将是一个待执行的函数形式\r\nlet requests = []\r\n\r\n// 响应拦截 \r\nhttp.interceptors.response.use((response) => {\r\n\tconst token = uni.getStorageSync('token')\r\n\tconst refresh_token = uni.getStorageSync('refresh_token')\r\n\tif (response) {\r\n\t\tconsole.log('封装后 结果（1）：', response)\r\n\t\t\r\n\t\t//是否取消显示等待框\r\n\t\tlet show = response.config.custom.show ? response.config.custom.show : false;\r\n\t\tif (show) {\r\n\t\t\tuni.hideLoading();\r\n\t\t}\r\n\t\t\r\n\t\tswitch (response.data.code) {\r\n\t\t\tcase 200:\r\n\t\t\t\treturn Promise.resolve(response.data.data)\r\n\t\t\tcase 401:\r\n\t\t\t\tuni.navigateTo({\r\n\t\t\t\t\turl: '/pages/user-login/login'\r\n\t\t\t\t})\r\n\t\t\t\treturn Promise.reject(response)\r\n\r\n\t\t\tdefault:\r\n\t\t\t\treturn Promise.reject(response)\r\n\t\t}\r\n\t}\r\n\r\n\t//完全成功，返回数据\r\n\treturn response['data']\r\n}, err => {\r\n\treturn Promise.reject(err)\r\n})\r\n\r\nexport {\r\n\thttp,\r\n\tbaseURL\r\n}"],"names":["Request","uni"],"mappings":";;;AAEA,MAAM,UAAU;AASV,MAAA,OAAO,IAAIA,+BAAAA,QAAQ;AAIzB,KAAK,UAAU,CAAC,WAAW;AAE1B,SAAO,UAAU;AACjB,SAAO,SAAS;AAAA,IACf,GAAG,OAAO;AAAA,EAAA;AAEJ,SAAA;AACR,CAAC;AAGD,KAAK,aAAa,QAAQ,IAAI,CAAC,WAAW;AAGzC,MAAI,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO;AACrD,MAAI,MAAM;AACL,QAAA,aAAa,QAAQ,OAAO,OAAO;AACvCC,kBAAAA,MAAI,YAAY;AAAA,MACf,OAAO;AAAA,MACP,MAAK;AAAA;AAAA,IAAA,CACL;AAAA,EACF;AAEA,SAAO,SAAS;AAAA,IACf,GAAG,OAAO;AAAA,IACV,gBAAgBA,cAAAA,MAAI,eAAe,OAAO;AAAA,EAAA;AAEpC,SAAA;AACR,GAAG,CAAC,QAAQ;AACJ,SAAA,QAAQ,OAAO,GAAG;AAC1B,CAAC;AAQD,KAAK,aAAa,SAAS,IAAI,CAAC,aAAa;AAC9BA,gBAAI,MAAA,eAAe,OAAO;AAClBA,gBAAI,MAAA,eAAe,eAAe;AACxD,MAAI,UAAU;AACbA,kBAAA,MAAY,MAAA,OAAA,0BAAA,cAAc,QAAQ;AAG9B,QAAA,OAAO,SAAS,OAAO,OAAO,OAAO,SAAS,OAAO,OAAO,OAAO;AACvE,QAAI,MAAM;AACTA,oBAAA,MAAI,YAAY;AAAA,IACjB;AAEQ,YAAA,SAAS,KAAK,MAAM;AAAA,MAC3B,KAAK;AACJ,eAAO,QAAQ,QAAQ,SAAS,KAAK,IAAI;AAAA,MAC1C,KAAK;AACJA,sBAAAA,MAAI,WAAW;AAAA,UACd,KAAK;AAAA,QAAA,CACL;AACM,eAAA,QAAQ,OAAO,QAAQ;AAAA,MAE/B;AACQ,eAAA,QAAQ,OAAO,QAAQ;AAAA,IAChC;AAAA,EACD;AAGA,SAAO,SAAS,MAAM;AACvB,GAAG,CAAO,QAAA;AACF,SAAA,QAAQ,OAAO,GAAG;AAC1B,CAAC;;;"}