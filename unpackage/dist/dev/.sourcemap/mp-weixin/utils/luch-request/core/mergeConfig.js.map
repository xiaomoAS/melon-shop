{"version":3,"file":"mergeConfig.js","sources":["utils/luch-request/core/mergeConfig.js"],"sourcesContent":["import {deepMerge, isUndefined} from '../utils'\r\n\r\n/**\r\n * 合并局部配置优先的配置，如果局部有该配置项则用局部，如果全局有该配置项则用全局\r\n * @param {Array} keys - 配置项\r\n * @param {Object} globalsConfig - 当前的全局配置\r\n * @param {Object} config2 - 局部配置\r\n * @return {{}}\r\n */\r\nconst mergeKeys = (keys, globalsConfig, config2) => {\r\n  let config = {}\r\n  keys.forEach(prop => {\r\n    if (!isUndefined(config2[prop])) {\r\n      config[prop] = config2[prop]\r\n    } else if (!isUndefined(globalsConfig[prop])) {\r\n      config[prop] = globalsConfig[prop]\r\n    }\r\n  })\r\n  return config\r\n}\r\n/**\r\n *\r\n * @param globalsConfig - 当前实例的全局配置\r\n * @param config2 - 当前的局部配置\r\n * @return - 合并后的配置\r\n */\r\nexport default (globalsConfig, config2 = {}) => {\r\n  const method = config2.method || globalsConfig.method || 'GET'\r\n  let config = {\r\n    baseURL: config2.baseURL || globalsConfig.baseURL || '',\r\n    method: method,\r\n    url: config2.url || '',\r\n    params: config2.params || {},\r\n    custom: {...(globalsConfig.custom || {}), ...(config2.custom || {})},\r\n    header: deepMerge(globalsConfig.header || {}, config2.header || {})\r\n  }\r\n  const defaultToConfig2Keys = ['getTask', 'validateStatus', 'paramsSerializer', 'forcedJSONParsing']\r\n  config = {...config, ...mergeKeys(defaultToConfig2Keys, globalsConfig, config2)}\r\n\r\n  // eslint-disable-next-line no-empty\r\n  if (method === 'DOWNLOAD') {\r\n    const downloadKeys = [\r\n      // #ifdef H5 || APP-PLUS || MP-WEIXIN || MP-ALIPAY || MP-TOUTIAO || MP-KUAISHOU\r\n      'timeout',\r\n      // #endif\r\n      // #ifdef MP\r\n      'filePath',\r\n      // #endif\r\n    ]\r\n    config = {...config, ...mergeKeys(downloadKeys, globalsConfig, config2)}\r\n  } else if (method === 'UPLOAD') {\r\n    delete config.header['content-type']\r\n    delete config.header['Content-Type']\r\n    const uploadKeys = [\r\n      // #ifdef APP-PLUS || H5\r\n      'files',\r\n      // #endif\r\n      // #ifdef MP-ALIPAY\r\n      'fileType',\r\n      // #endif\r\n      // #ifdef H5\r\n      'file',\r\n      // #endif\r\n      'filePath',\r\n      'name',\r\n      // #ifdef H5 || APP-PLUS || MP-WEIXIN || MP-ALIPAY || MP-TOUTIAO || MP-KUAISHOU\r\n      'timeout',\r\n      // #endif\r\n      'formData',\r\n    ]\r\n    uploadKeys.forEach(prop => {\r\n      if (!isUndefined(config2[prop])) {\r\n        config[prop] = config2[prop]\r\n      }\r\n    })\r\n    // #ifdef H5 || APP-PLUS || MP-WEIXIN || MP-ALIPAY || MP-TOUTIAO || MP-KUAISHOU\r\n    if (isUndefined(config.timeout) && !isUndefined(globalsConfig.timeout)) {\r\n      config['timeout'] = globalsConfig['timeout']\r\n    }\r\n    // #endif\r\n  } else {\r\n    const defaultsKeys = [\r\n      'data',\r\n      // #ifdef H5 || APP-PLUS || MP-ALIPAY || MP-WEIXIN\r\n      'timeout',\r\n      // #endif\r\n      'dataType',\r\n      // #ifndef MP-ALIPAY\r\n      'responseType',\r\n      // #endif\r\n      // #ifdef APP-PLUS\r\n      'sslVerify',\r\n      // #endif\r\n      // #ifdef H5\r\n      'withCredentials',\r\n      // #endif\r\n      // #ifdef APP-PLUS\r\n      'firstIpv4',\r\n      // #endif\r\n      // #ifdef MP-WEIXIN\r\n      'enableHttp2',\r\n      'enableQuic',\r\n      // #endif\r\n      // #ifdef MP-TOUTIAO || MP-WEIXIN\r\n      'enableCache',\r\n      // #endif\r\n      // #ifdef MP-WEIXIN\r\n      'enableHttpDNS',\r\n      'httpDNSServiceId',\r\n      'enableChunked',\r\n      'forceCellularNetwork',\r\n      // #endif\r\n      // #ifdef MP-ALIPAY\r\n      'enableCookie',\r\n      // #endif\r\n      // #ifdef MP-BAIDU\r\n      'cloudCache',\r\n      'defer'\r\n      // #endif\r\n\r\n    ]\r\n    config = {...config, ...mergeKeys(defaultsKeys, globalsConfig, config2)}\r\n  }\r\n\r\n  return config\r\n}\r\n"],"names":["isUndefined","deepMerge"],"mappings":";;AASA,MAAM,YAAY,CAAC,MAAM,eAAe,YAAY;AAClD,MAAI,SAAS,CAAE;AACf,OAAK,QAAQ,UAAQ;AACnB,QAAI,CAACA,wBAAW,YAAC,QAAQ,IAAI,CAAC,GAAG;AAC/B,aAAO,IAAI,IAAI,QAAQ,IAAI;AAAA,IAC5B,WAAU,CAACA,wBAAW,YAAC,cAAc,IAAI,CAAC,GAAG;AAC5C,aAAO,IAAI,IAAI,cAAc,IAAI;AAAA,IAClC;AAAA,EACL,CAAG;AACD,SAAO;AACT;AAOA,MAAA,cAAe,CAAC,eAAe,UAAU,OAAO;AAC9C,QAAM,SAAS,QAAQ,UAAU,cAAc,UAAU;AACzD,MAAI,SAAS;AAAA,IACX,SAAS,QAAQ,WAAW,cAAc,WAAW;AAAA,IACrD;AAAA,IACA,KAAK,QAAQ,OAAO;AAAA,IACpB,QAAQ,QAAQ,UAAU,CAAE;AAAA,IAC5B,QAAQ,EAAC,GAAI,cAAc,UAAU,CAAE,GAAG,GAAI,QAAQ,UAAU,GAAI;AAAA,IACpE,QAAQC,wBAAS,UAAC,cAAc,UAAU,CAAA,GAAI,QAAQ,UAAU,EAAE;AAAA,EACnE;AACD,QAAM,uBAAuB,CAAC,WAAW,kBAAkB,oBAAoB,mBAAmB;AAClG,WAAS,EAAC,GAAG,QAAQ,GAAG,UAAU,sBAAsB,eAAe,OAAO,EAAC;AAG/E,MAAI,WAAW,YAAY;AACzB,UAAM,eAAe;AAAA,MAEnB;AAAA,MAGA;AAAA,IAED;AACD,aAAS,EAAC,GAAG,QAAQ,GAAG,UAAU,cAAc,eAAe,OAAO,EAAC;AAAA,EAC3E,WAAa,WAAW,UAAU;AAC9B,WAAO,OAAO,OAAO,cAAc;AACnC,WAAO,OAAO,OAAO,cAAc;AACnC,UAAM,aAAa;AAAA,MAUjB;AAAA,MACA;AAAA,MAEA;AAAA,MAEA;AAAA,IACD;AACD,eAAW,QAAQ,UAAQ;AACzB,UAAI,CAACD,wBAAW,YAAC,QAAQ,IAAI,CAAC,GAAG;AAC/B,eAAO,IAAI,IAAI,QAAQ,IAAI;AAAA,MAC5B;AAAA,IACP,CAAK;AAED,QAAIA,wBAAAA,YAAY,OAAO,OAAO,KAAK,CAACA,oCAAY,cAAc,OAAO,GAAG;AACtE,aAAO,SAAS,IAAI,cAAc,SAAS;AAAA,IAC5C;AAAA,EAEL,OAAS;AACL,UAAM,eAAe;AAAA,MACnB;AAAA,MAEA;AAAA,MAEA;AAAA,MAEA;AAAA,MAYA;AAAA,MACA;AAAA,MAGA;AAAA,MAGA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,IAUD;AACD,aAAS,EAAC,GAAG,QAAQ,GAAG,UAAU,cAAc,eAAe,OAAO,EAAC;AAAA,EACxE;AAED,SAAO;AACT;;"}